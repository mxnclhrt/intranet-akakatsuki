name: üîÑ Mise √† jour automatique de l'emploi du temps
on:
  schedule:
    - cron: '0 * * * *'  # Toutes les heures
  workflow_dispatch:       # Permet aussi de lancer manuellement
permissions:
  contents: write           # Permission d'√©criture sur le d√©p√¥t
jobs:
  update-emploi:
    runs-on: ubuntu-latest
    steps:
      - name: üõéÔ∏è Cloner le d√©p√¥t
        uses: actions/checkout@v4
      - name: üìÅ Cr√©er le r√©pertoire si n√©cessaire
        run: |
          mkdir -p src/emploi-du-temps
      - name: üì• T√©l√©charger les fichier ICS G1 et G2
        run: |
          echo "üì• T√©l√©chargement de l'emploi du temps G1..."
          curl -L -o src/emploi-du-temps/emploi-du-temps-G1.ics "https://hplanning.univ-lehavre.fr/Telechargements/ical/Edt_INFOG1.ics?version=2022.0.5.0&idICal=4B80C98DBFC3B008B2D05301CB645CA9&param=643d5b312e2e36325d2666683d3126663d31"
          
          echo "üì• T√©l√©chargement de l'emploi du temps G2..."
          curl -L -o src/emploi-du-temps/emploi-du-temps-G2.ics "https://hplanning.univ-lehavre.fr/Telechargements/ical/Edt_INFOG2.ics?version=2022.0.5.0&idICal=44AB2688C2CC0095C8BC88B7F49766AD&param=643d5b312e2e36325d2666683d3126663d31"
      - name: üíæ Commit et push si modification
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Ajouter les deux fichiers
          git add src/emploi-du-temps/emploi-du-temps-G1.ics
          git add src/emploi-du-temps/emploi-du-temps-G2.ics
          
          # V√©rifie si le fichier a chang√©
          if ! git diff --cached --quiet; then
            git commit -m "Mise √† jour automatique de l'emploi du temps"
            # Configure le remote avec le PAT pour push
            git remote set-url origin https://x-access-token:$GH_PAT@github.com/${{ github.repository }}.git
            git push origin main
          else
            echo "Aucune modification d√©tect√©e"
          fi
